<%= render 'my/menu' %>
<h1>
  <%= current_user.first_name%> <%= current_user.last_name %>'s Dashboard
</h1>

<%# This is a the data that will be used for the dasboard "menu" navbar  %>
<div class="bookings-card">
  <h2>Next Lesson</h3>
  
  <div class="booking">
  <%# if statement in block below controls what is displayed 
  depending on if the user has booked a lesson or not
  LOGIC BELOW STILL NEEDS WORK -- IT ONLY SHOWS THE FIRST BOOKING OF CURRENT_USER NEED TO SHOW NEXT BOOKING%>
    <% if current_user.has_made_a_booking? %>
        <p><strong><%= current_user.bookings.first.lesson.user.first_name %>
          <%= current_user.bookings.first.lesson.user.last_name %></strong></p>
        <p><%= current_user.bookings.first.lesson.industry.capitalize %></p>
        <p><%= current_user.bookings.first.start_time %></p>
        
        <div class="videocall">
          <button><%= link_to "JOIN VIDEO", my_video_path  %></button>
        </div>
      <% else %>
        <p>You do not have any upcoming lessons</p>
    <% end %>
  </div>
</div>

<div class="bookings-card">
  <h2>Your lessons</h3>

  <h3>Upcoming Lessons</h3>
  <% @my_bookings.each do |booking| %>
    <% if Time.now < booking.end_time %>
      <div class="booking-card">
        <p><strong><%= booking.lesson.user.first_name %> <%= booking.lesson.user.last_name %></strong></p>
        <p><%= booking.lesson.industry %></p>
        <p><%= booking.start_time %></p>
      </div>
    <% end %>
  <% end %>
  <h3>Past Lessons</h3>
  <% @my_bookings.each do |booking| %>
    <% if Time.now >= booking.end_time %>
      <div class="booking-card">
        <p><%= booking.user.email %></p>
        <p><%= booking.lesson.industry %></p>
        <p><%= booking.start_time %></p>
        <% if booking.report == nil %>
          <button><%= link_to "Create Report", new_booking_report_path(booking) %></button>
        <% else %>
          <button><%= link_to "View Report", report_path(booking.report) %></button>
        <% end %>
      </div>
    <% end %>
  <% end %>
</div>

<div class="reports-card">
  <h2>Reports</h2>
  <%# if current_user.bookings. %>
  <% current_user.bookings.find_each do |booking| %> 
    <div class="report-card">
      <p><strong><%= booking.lesson.user.first_name %>
        <%= booking.lesson.user.last_name %></strong></p>
      <p><%= booking.lesson.industry.capitalize %></p>
      <p> <%#= booking.report.date %> </p>
    </div>
  <% end %>
</div>


